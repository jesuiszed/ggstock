{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Devis {{ devis.numero_devis }}</title>
    {% include 'inventory/pdf_base_styles.html' %}
    <style>
        /* Couleurs spécifiques pour les devis - Bleu */
        body::before {
            opacity: 0.04;
        }
    </style>
</head>
<body style="--primary-color: #2563eb; --light-bg: #f8fafc;">
    <!-- EN-TÊTE -->
    <div class="header">
        <div class="logo-section">
            <img src="file:///{{ logo_path }}" alt="DIMAT MEDICAL Logo" class="logo" onerror="this.style.display='none'">
            <div class="company-name">DIMAT MEDICAL</div>
            <div class="company-info">
                <strong>Zybio Business Manager - Sénégal</strong><br>
                Adresse : Dakar, Sénégal<br>
                Tél : +221 XX XXX XX XX<br>
                Email : contact@dimatmedical.sn
            </div>
        </div>
        
        <div class="doc-title">
            <h1>DEVIS</h1>
            <div class="doc-number">N° {{ devis.numero_devis }}</div>
        </div>
    </div>
    
    <!-- INFORMATIONS CLIENT ET DEVIS -->
    <div class="info-section">
        <div class="info-box">
            <div class="info-title">Client</div>
            <div class="info-content">
                <div><span class="info-label">Nom :</span> {{ devis.client.nom_complet }}</div>
                <div><span class="info-label">Adresse :</span> {{ devis.client.adresse }}</div>
                <div><span class="info-label">Téléphone :</span> {{ devis.client.telephone }}</div>
                <div><span class="info-label">Email :</span> {{ devis.client.email }}</div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="info-title">Détails du Devis</div>
            <div class="info-content">
                <div><span class="info-label">Date :</span> {{ devis.date_creation|date:"d/m/Y" }}</div>
                <div><span class="info-label">Validité :</span> {{ devis.date_validite|date:"d/m/Y" }}</div>
                <div><span class="info-label">Commercial :</span> {{ devis.commercial.get_full_name|default:devis.commercial.username }}</div>
                <div><span class="info-label">Statut :</span> <span class="status-badge status-{{ devis.statut|lower }}">{{ devis.get_statut_display }}</span></div>
            </div>
        </div>
    </div>
    
    <!-- TABLEAU DES PRODUITS -->
    <div class="products-section no-page-break">
        <div class="section-title">Détail des Produits / Services</div>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%;">N°</th>
                        <th style="width: 35%;">Désignation</th>
                        <th class="center" style="width: 10%;">Quantité</th>
                        <th class="right" style="width: 15%;">Prix Unitaire</th>
                        <th class="center" style="width: 10%;">Remise</th>
                        <th class="right" style="width: 15%;">Montant HT</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ligne in lignes_devis %}
                    <tr>
                        <td class="center">{{ forloop.counter }}</td>
                        <td class="product-name">{{ ligne.produit.nom }}</td>
                        <td class="center">{{ ligne.quantite }}</td>
                        <td class="right">{{ ligne.prix_unitaire|floatformat:0 }} F CFA</td>
                        <td class="center">{{ ligne.remise|floatformat:0 }}%</td>
                        <td class="right currency">{{ ligne.sous_total|floatformat:0 }} F CFA</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- TOTAUX -->
    <div class="totals-section">
        <div class="totals-box">
            <div class="total-row subtotal">
                <span class="total-label">Sous-total HT :</span>
                <span class="total-value">{{ devis.total|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row">
                <span class="total-label">TVA (18%) :</span>
                <span class="total-value">{{ tva|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row final">
                <span class="total-label">TOTAL TTC :</span>
                <span class="total-value">{{ total_ttc|floatformat:0 }} F CFA</span>
            </div>
        </div>
    </div>
    
    <!-- CONDITIONS COMMERCIALES -->
    <div class="conditions-section">
        <div class="section-title">Conditions Commerciales</div>
        <div class="conditions-box">
            <div class="condition-item">
                <strong>Garantie :</strong> Garantie fabricant de 12 mois à compter de la date de livraison
            </div>
            <div class="condition-item">
                <strong>Service Après-Vente (SAV) :</strong> Support technique disponible du lundi au vendredi (9h-17h). Intervention sous 48h ouvrées
            </div>
            <div class="condition-item">
                <strong>Validité de l'offre :</strong> Ce devis est valable jusqu'au {{ devis.date_validite|date:"d/m/Y" }}
            </div>
            <div class="condition-item">
                <strong>Livraison :</strong> Livraison et installation sur site sous 7 à 10 jours ouvrables après réception du bon de commande
            </div>
            <div class="condition-item">
                <strong>Mode de paiement :</strong> 40% à la commande, 60% à la livraison. Paiement par virement bancaire ou chèque certifié
            </div>
            <div class="condition-item">
                <strong>Formation :</strong> Formation gratuite du personnel à l'utilisation des équipements livrés (1 session de 2 heures)
            </div>
        </div>
    </div>
    
    <!-- NOTES PARTICULIÈRES -->
    {% if devis.notes or devis.conditions_particulieres %}
    <div class="notes-section">
        <div class="section-title">Notes et Conditions Particulières</div>
        <div class="notes-content">
            {% if devis.notes %}
                <strong>Notes :</strong> {{ devis.notes }}<br><br>
            {% endif %}
            {% if devis.conditions_particulieres %}
                <strong>Conditions particulières :</strong> {{ devis.conditions_particulieres }}
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <!-- SECTION SIGNATURE -->
    <div class="signature-section">
        <div class="lu-approuve">
            "Bon pour accord - Lu et approuvé"<br>
            En signant ce document, vous acceptez les termes et conditions ci-dessus
        </div>
        
        <div class="signatures">
            <div class="signature-box">
                <div class="signature-title">Pour l'Entreprise</div>
                <div class="signature-line">
                    Signature et Cachet<br>
                    DIMAT MEDICAL
                </div>
            </div>
            
            <div class="signature-box">
                <div class="signature-title">Le Client</div>
                <div class="signature-line">
                    Signature<br>
                    {{ devis.client.nom_complet }}
                </div>
            </div>
        </div>
    </div>
    
    <!-- FOOTER -->
    <div class="footer">
        Document généré le {{ now|date:"d/m/Y à H:i" }} - DIMAT MEDICAL / Zybio Business Manager Sénégal<br>
        Devis non contractuel jusqu'à signature - Tous droits réservés
    </div>
</body>
</html>
