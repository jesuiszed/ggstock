{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Facture Proforma {{ commande.numero_commande }}</title>
    {% include 'inventory/pdf_base_styles.html' %}
    <style>
        /* Couleurs spécifiques pour facture proforma - Orange */
        body::before {
            opacity: 0.04;
        }
    </style>
</head>
<body style="--primary-color: #f59e0b; --light-bg: #fffbeb;">
    <!-- EN-TÊTE -->
    <div class="header">
        <div class="logo-section">
            <img src="file:///{{ logo_path }}" alt="DIMAT MEDICAL Logo" class="logo" onerror="this.style.display='none'">
            <div class="company-name">DIMAT MEDICAL</div>
            <div class="company-info">
                <strong>Zybio Business Manager - Sénégal</strong><br>
                Adresse : Dakar, Sénégal<br>
                Tél : +221 XX XXX XX XX<br>
                Email : contact@dimatmedical.sn<br>
                NINEA : XXXXXXXXXX
            </div>
        </div>
        
        <div class="doc-title">
            <h1>FACTURE PROFORMA</h1>
            <div class="doc-number">N° {{ commande.numero_commande }}</div>
        </div>
    </div>
    
    <!-- INFORMATIONS FOURNISSEUR ET FACTURE -->
    <div class="info-section">
        <div class="info-box">
            <div class="info-title">Fournisseur</div>
            <div class="info-content">
                <div><span class="info-label">Nom :</span> {{ commande.fournisseur.nom }}</div>
                <div><span class="info-label">Adresse :</span> {{ commande.fournisseur.adresse }}</div>
                <div><span class="info-label">Ville :</span> {{ commande.fournisseur.ville }}, {{ commande.fournisseur.pays }}</div>
                <div><span class="info-label">Téléphone :</span> {{ commande.fournisseur.telephone }}</div>
                <div><span class="info-label">Email :</span> {{ commande.fournisseur.email }}</div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="info-title">Détails de la Facture</div>
            <div class="info-content">
                <div><span class="info-label">Date émission :</span> {{ now|date:"d/m/Y" }}</div>
                <div><span class="info-label">Date commande :</span> {{ commande.date_commande|date:"d/m/Y" }}</div>
                <div><span class="info-label">Responsable :</span> {{ commande.utilisateur.get_full_name|default:commande.utilisateur.username }}</div>
                <div><span class="info-label">Référence :</span> {{ commande.numero_commande }}</div>
            </div>
        </div>
    </div>
    
    <!-- TABLEAU DES PRODUITS -->
    <div class="products-section no-page-break">
        <div class="section-title">Détail des Produits et Services</div>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%;">N°</th>
                        <th style="width: 40%;">Désignation</th>
                        <th style="width: 12%;">Référence</th>
                        <th class="center" style="width: 8%;">Qté</th>
                        <th class="right" style="width: 15%;">P.U. HT</th>
                        <th class="right" style="width: 15%;">Montant HT</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ligne in lignes_commande %}
                    <tr>
                        <td class="center">{{ forloop.counter }}</td>
                        <td class="product-name">{{ ligne.produit.nom }}</td>
                        <td>{{ ligne.produit.reference }}</td>
                        <td class="center">{{ ligne.quantite }}</td>
                        <td class="right">{{ ligne.prix_unitaire|floatformat:0 }} F CFA</td>
                        <td class="right currency">{{ ligne.sous_total|floatformat:0 }} F CFA</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- TOTAUX DÉTAILLÉS -->
    <div class="totals-section">
        <div class="totals-box">
            <div class="total-row">
                <span class="total-label">Total HT :</span>
                <span class="total-value">{{ commande.total|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row">
                <span class="total-label">TVA (18%) :</span>
                <span class="total-value">{{ tva|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row subtotal">
                <span class="total-label">Total TTC :</span>
                <span class="total-value">{{ total_ttc|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row final">
                <span class="total-label">NET À PAYER :</span>
                <span class="total-value">{{ total_ttc|floatformat:0 }} F CFA</span>
            </div>
        </div>
    </div>
    
    <!-- INFORMATIONS DE PAIEMENT -->
    <div class="conditions-section">
        <div class="section-title">Conditions de Paiement</div>
        <div class="conditions-box">
            <div class="condition-item">
                <strong>Mode de règlement :</strong> Virement bancaire ou chèque certifié
            </div>
            <div class="condition-item">
                <strong>Coordonnées bancaires :</strong><br>
                Banque : [NOM DE LA BANQUE]<br>
                IBAN : [NUMÉRO IBAN]<br>
                SWIFT/BIC : [CODE SWIFT]<br>
                Titulaire : DIMAT MEDICAL
            </div>
            <div class="condition-item">
                <strong>Échéance :</strong> Paiement à 30 jours fin de mois après réception de la facture définitive
            </div>
            <div class="condition-item">
                <strong>Pénalités de retard :</strong> En cas de retard de paiement, des pénalités au taux légal en vigueur seront appliquées
            </div>
            <div class="condition-item">
                <strong>Escompte :</strong> Aucun escompte accordé pour paiement anticipé sauf accord préalable
            </div>
        </div>
    </div>
    
    <!-- MENTIONS LÉGALES -->
    <div class="notes-section">
        <div class="section-title">Mentions Légales</div>
        <div class="notes-content">
            <strong>Facture Proforma :</strong> Ce document est une facture proforma et ne constitue pas une facture définitive. 
            Elle est fournie à titre indicatif et n'a pas de valeur comptable ou fiscale. 
            Une facture définitive sera émise après réception et vérification de la marchandise.<br><br>
            
            <strong>TVA :</strong> TVA non applicable selon l'article [référence] ou TVA récupérable.<br><br>
            
            <strong>Juridiction :</strong> En cas de litige, les tribunaux de Dakar seront seuls compétents.
        </div>
    </div>
    
    {% if commande.notes %}
    <div class="notes-section">
        <div class="section-title">Observations</div>
        <div class="notes-content">
            {{ commande.notes }}
        </div>
    </div>
    {% endif %}
    
    <!-- SECTION SIGNATURE -->
    <div class="signature-section">
        <div class="lu-approuve">
            "Facture Proforma - Document non comptabilisable"<br>
            Ce document engage les deux parties pour la commande référencée ci-dessus
        </div>
        
        <div class="signatures">
            <div class="signature-box">
                <div class="signature-title">Pour DIMAT MEDICAL</div>
                <div class="signature-line">
                    Signature et Cachet<br>
                    {{ commande.utilisateur.get_full_name|default:commande.utilisateur.username }}
                </div>
            </div>
            
            <div class="signature-box">
                <div class="signature-title">Le Fournisseur</div>
                <div class="signature-line">
                    Signature et Cachet<br>
                    {{ commande.fournisseur.nom }}
                </div>
            </div>
        </div>
    </div>
    
    <!-- FOOTER -->
    <div class="footer">
        Facture Proforma générée le {{ now|date:"d/m/Y à H:i" }} - DIMAT MEDICAL / Zybio Business Manager Sénégal<br>
        Document provisoire - La facture définitive sera émise après livraison - NINEA : XXXXXXXXXX
    </div>
</body>
</html>
