{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Bon de Commande {{ commande.numero_commande }}</title>
    {% include 'inventory/pdf_base_styles.html' %}
    <style>
        /* Couleurs spécifiques pour bon de commande - Vert */
        body::before {
            opacity: 0.04;
        }
    </style>
</head>
<body style="--primary-color: #10b981; --light-bg: #f0fdf4;">
    <!-- EN-TÊTE -->
    <div class="header">
        <div class="logo-section">
            <img src="file:///{{ logo_path }}" alt="DIMAT MEDICAL Logo" class="logo" onerror="this.style.display='none'">
            <div class="company-name">DIMAT MEDICAL</div>
            <div class="company-info">
                <strong>Zybio Business Manager - Sénégal</strong><br>
                Adresse : Dakar, Sénégal<br>
                Tél : +221 XX XXX XX XX<br>
                Email : contact@dimatmedical.sn
            </div>
        </div>
        
        <div class="doc-title">
            <h1>BON DE COMMANDE</h1>
            <div class="doc-number">N° {{ commande.numero_commande }}</div>
        </div>
    </div>
    
    <!-- INFORMATIONS FOURNISSEUR ET COMMANDE -->
    <div class="info-section">
        <div class="info-box">
            <div class="info-title">Fournisseur</div>
            <div class="info-content">
                <div><span class="info-label">Nom :</span> {{ commande.fournisseur.nom }}</div>
                <div><span class="info-label">Adresse :</span> {{ commande.fournisseur.adresse }}, {{ commande.fournisseur.ville }}</div>
                <div><span class="info-label">Téléphone :</span> {{ commande.fournisseur.telephone }}</div>
                <div><span class="info-label">Email :</span> {{ commande.fournisseur.email }}</div>
            </div>
        </div>
        
        <div class="info-box">
            <div class="info-title">Détails de la Commande</div>
            <div class="info-content">
                <div><span class="info-label">Date :</span> {{ commande.date_commande|date:"d/m/Y" }}</div>
                <div><span class="info-label">Responsable :</span> {{ commande.utilisateur.get_full_name|default:commande.utilisateur.username }}</div>
                <div><span class="info-label">Statut :</span> <span class="status-badge status-{{ commande.statut|lower }}">{{ commande.get_statut_display }}</span></div>
                {% if commande.date_livraison_prevue %}
                <div><span class="info-label">Livraison prévue :</span> {{ commande.date_livraison_prevue|date:"d/m/Y" }}</div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- TABLEAU DES PRODUITS -->
    <div class="products-section no-page-break">
        <div class="section-title">Détail des Produits Commandés</div>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%;">N°</th>
                        <th style="width: 35%;">Désignation</th>
                        <th style="width: 15%;">Référence</th>
                        <th class="center" style="width: 10%;">Quantité</th>
                        <th class="right" style="width: 15%;">Prix Unitaire</th>
                        <th class="right" style="width: 15%;">Montant Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ligne in lignes_commande %}
                    <tr>
                        <td class="center">{{ forloop.counter }}</td>
                        <td class="product-name">{{ ligne.produit.nom }}</td>
                        <td>{{ ligne.produit.reference }}</td>
                        <td class="center">{{ ligne.quantite }}</td>
                        <td class="right">{{ ligne.prix_unitaire|floatformat:0 }} F CFA</td>
                        <td class="right currency">{{ ligne.sous_total|floatformat:0 }} F CFA</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- TOTAUX -->
    <div class="totals-section">
        <div class="totals-box">
            <div class="total-row subtotal">
                <span class="total-label">Sous-total HT :</span>
                <span class="total-value">{{ commande.total|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row">
                <span class="total-label">TVA (18%) :</span>
                <span class="total-value">{{ tva|floatformat:0 }} F CFA</span>
            </div>
            <div class="total-row final">
                <span class="total-label">TOTAL TTC :</span>
                <span class="total-value">{{ total_ttc|floatformat:0 }} F CFA</span>
            </div>
        </div>
    </div>
    
    <!-- CONDITIONS DE COMMANDE -->
    <div class="conditions-section">
        <div class="section-title">Conditions de Commande</div>
        <div class="conditions-box">
            <div class="condition-item">
                <strong>Délai de livraison :</strong> Les produits doivent être livrés dans un délai maximum de 15 jours ouvrables à compter de la date de réception de ce bon de commande
            </div>
            <div class="condition-item">
                <strong>Lieu de livraison :</strong> Les produits seront livrés à l'adresse de DIMAT MEDICAL, Dakar, Sénégal
            </div>
            <div class="condition-item">
                <strong>Conditions de paiement :</strong> Paiement à 30 jours fin de mois après réception et vérification de la marchandise
            </div>
            <div class="condition-item">
                <strong>Conformité :</strong> Les produits livrés doivent être strictement conformes aux spécifications indiquées dans ce bon de commande
            </div>
            <div class="condition-item">
                <strong>Documents requis :</strong> Facture originale, certificats de conformité, fiches techniques et manuels d'utilisation en français
            </div>
            <div class="condition-item">
                <strong>Garantie :</strong> Garantie fabricant minimale de 12 mois sur tous les équipements fournis
            </div>
        </div>
    </div>
    
    <!-- NOTES PARTICULIÈRES -->
    {% if commande.notes %}
    <div class="notes-section">
        <div class="section-title">Notes Particulières</div>
        <div class="notes-content">
            {{ commande.notes }}
        </div>
    </div>
    {% endif %}
    
    <!-- SECTION SIGNATURE -->
    <div class="signature-section">
        <div class="lu-approuve">
            "Bon pour accord - Commande confirmée"<br>
            Le fournisseur s'engage à respecter les conditions ci-dessus
        </div>
        
        <div class="signatures">
            <div class="signature-box">
                <div class="signature-title">Pour DIMAT MEDICAL</div>
                <div class="signature-line">
                    Signature et Cachet<br>
                    {{ commande.utilisateur.get_full_name|default:commande.utilisateur.username }}
                </div>
            </div>
            
            <div class="signature-box">
                <div class="signature-title">Le Fournisseur</div>
                <div class="signature-line">
                    Signature et Cachet<br>
                    {{ commande.fournisseur.nom }}
                </div>
            </div>
        </div>
    </div>
    
    <!-- FOOTER -->
    <div class="footer">
        Document généré le {{ now|date:"d/m/Y à H:i" }} - DIMAT MEDICAL / Zybio Business Manager Sénégal<br>
        Bon de commande officiel - Tous droits réservés
    </div>
</body>
</html>
